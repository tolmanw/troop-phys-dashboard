async function loadData(activityType="All") {
    const response = await fetch("data/athletes.json");
    const data = await response.json();
    const container = document.getElementById("container");
    container.innerHTML = "";

    const monthNames = data.month_names;

    Object.entries(data.athletes).forEach(([username, athlete]) => {

        // Distance data
        const monthlyDistance = activityType === "All" ? athlete.monthly_total_miles : athlete.monthly_by_type_miles[activityType];
        const dailyDistance = activityType === "All" ? athlete.daily_total_miles : athlete.daily_by_type_miles[activityType];

        // Time data
        const monthlyTimeArr = activityType === "All" ? athlete.monthly_total_time : athlete.monthly_time_by_type[activityType];
        const dailyTimeArr = activityType === "All" ? athlete.daily_total_time : athlete.daily_time_by_type[activityType];

        // Convert hh:mm to minutes for Chart.js plotting
        function hhmmToMinutes(arr){ 
            return arr.map(s => { 
                const [h,m] = s.split(":"); 
                return parseInt(h)*60 + parseInt(m); 
            }); 
        }

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <div class="athlete">
                <img src="${athlete.profile}">
                <div>
                    <h2>${athlete.firstname} ${athlete.lastname}</h2>
                    <p>@${athlete.username}</p>
                </div>
            </div>

            <h3>Monthly Distance (miles)</h3>
            <canvas id="monthChart-${username}"></canvas>

            <h3>Daily Distance (miles) - ${monthNames[1]}</h3>
            <canvas id="dailyChart-${username}"></canvas>

            <h3>Monthly Time (hh:mm)</h3>
            <canvas id="monthTimeChart-${username}"></canvas>

            <h3>Daily Time (hh:mm) - ${monthNames[1]}</h3>
            <canvas id="dailyTimeChart-${username}"></canvas>
        `;
        container.appendChild(card);

        new Chart(document.getElementById(`monthChart-${username}`), {
            type: "bar",
            data: {
                labels: monthNames,
                datasets: [{ label: "Distance (miles)", data: monthlyDistance, backgroundColor: "rgba(75, 192, 192, 0.6)" }]
            },
            options: { responsive: true, maintainAspectRatio: true }
        });

        new Chart(document.getElementById(`dailyChart-${username}`), {
            type: "line",
            data: {
                labels: dailyDistance.map((_, i) => i + 1),
                datasets: [{ label: "Daily Distance (miles)", data: dailyDistance, borderColor: "rgba(75, 192, 192, 1)", borderWidth: 2 }]
            },
            options: { responsive: true, maintainAspectRatio: true }
        });

        new Chart(document.getElementById(`monthTimeChart-${username}`), {
            type: "bar",
            data: {
                labels: monthNames,
                datasets: [{ label: "Monthly Time (minutes)", data: hhmmToMinutes(monthlyTimeArr), backgroundColor: "rgba(255, 159, 64, 0.6)" }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins:{
                    tooltip:{
                        callbacks:{
                            label: function(ctx){
                                return `Time: ${monthlyTimeArr[ctx.dataIndex]}`;
                            }
                        }
                    }
                }
            }
        });

        new Chart(document.getElementById(`dailyTimeChart-${username}`), {
            type: "line",
            data: {
                labels: dailyDistance.map((_, i) => i + 1),
                datasets: [{ label: "Daily Time (hh:mm)", data: hhmmToMinutes(dailyTimeArr), borderColor: "rgba(255, 159, 64, 1)", borderWidth: 2 }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins:{
                    tooltip:{
                        callbacks:{
                            label: function(ctx){
                                return `Time: ${dailyTimeArr[ctx.dataIndex]}`;
                            }
                        }
                    }
                }
            }
        });
    });
}
